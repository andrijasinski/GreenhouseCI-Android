buildscript {
    repositories {
        mavenCentral()
    }
    dependencies {
        classpath 'com.android.tools.build:gradle:1.2.2'
    }
}
apply plugin: 'android'

repositories {
    mavenCentral()
}

dependencies {
}

// This is unnecessary

android {
//	somethingRandom "something.random.here.as.well"
    compileSdkVersion 21
    buildToolsVersion "21.1.1"

    defaultConfig {
//        testInstrumentationRunner = "android.test.InstrumentationTestRunner"
        minSdkVersion 8
        targetSdkVersion 21

        println "\nEnvironment variables are:\n"
        System.getenv().sort().each {
            k, v -> println "${k}=\"${v}\""
        }
        println "\n"
    }

    productFlavors {

        flavor1 {
            applicationId "com.example.flavor1"
            versionName "2.2-flavor1"
        }

        flavor2 {
            applicationId "com.example.flavor2"
            versionName "1.3-flavor2"
        }
    }
}

task crashIfRequired << {
    def divideByZero = System.getenv()['DIVIDE_BY_ZERO']
    println "\n==============================="
    println "divideByZero=\"${divideByZero}\""
    if (!divideByZero) {
        println "divideByZero is set, will crash"
        println "===============================\n"
        1/0
    } else {
        println "divideByZero not set, will not crash"
        println "===============================\n"
    }
}

gradle.projectsEvaluated {
    assemble.dependsOn(crashIfRequired)
}
